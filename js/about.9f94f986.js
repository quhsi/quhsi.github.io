"use strict";(globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[]).push([[443],{29443:(e,t,s)=>{s.r(t),s.d(t,{default:()=>U});var a=s(59835),o=s(86970);const n=e=>((0,a.dD)("data-v-55beb4bb"),e=e(),(0,a.Cn)(),e),i={key:0,class:"flex row no-wrap items-center",style:{border:"1px solid var(--q-accent)","border-radius":".5rem",padding:".5rem",margin:".5rem",gap:".5rem"}},l=n((()=>(0,a._)("div",null,"to chat with the AI bot create a new post and mention it by typing '@gpt3' and selecting the AI bot from the user list",-1)));function d(e,t,s,n,d,r){const h=(0,a.up)("BaseHeader"),c=(0,a.up)("q-tab"),b=(0,a.up)("q-tabs"),u=(0,a.up)("q-icon"),f=(0,a.up)("BaseButtonLoadMore"),p=(0,a.up)("BasePostThread"),g=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(g,null,{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a.Wm)(h,{separator:!1},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("feed")),1)])),_:1}),(0,a.Wm)(b,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t),dense:"",outline:"",align:"left","active-color":"accent",breakpoint:0},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{name:"follows",label:"follows"}),(0,a.Wm)(c,{name:"global",label:"global"}),(0,a.Wm)(c,{name:"AI",label:"AI"}),(0,a.Wm)(c,{name:"bots",label:"bots"})])),_:1},8,["modelValue"])]),"AI"===e.tab?((0,a.wg)(),(0,a.iD)("div",i,[(0,a.Wm)(u,{name:"info",color:"accent",size:"sm"}),l])):(0,a.kq)("",!0),e.unreadFeed[e.tab].length?((0,a.wg)(),(0,a.j4)(f,{key:1,"loading-more":e.loadingUnread,label:"load "+e.unreadFeed[e.tab].length+" unread",onClick:e.loadUnread},null,8,["loading-more","label","onClick"])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.items,((t,s)=>((0,a.wg)(),(0,a.j4)(p,{key:s,events:t,class:"full-width",onAddEvent:e.processEvent},null,8,["events","onAddEvent"])))),128)),(0,a.Wm)(f,{"loading-more":e.loadingMore,label:e.items.length===e.feed[e.tab].length?"load another day":"load 100 more",onClick:e.loadMore},null,8,["loading-more","label","onClick"])])),_:1})}s(40702),s(46727);var r=s(18933),h=s(14473),c=s(22330),b=s(34136),u=s(80626),f=s(31020);const p={title:"astral",meta:{description:{name:"description",content:"decentralized social media feed built on Nostr"},keywords:{name:"keywords",content:"nostr decentralized social media"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}},g=(0,a.aZ)({name:"Feed",mixins:[r.Z,(0,f.Z)(p)],components:{BaseButtonLoadMore:u.Z},watch:{lookingAround(e,t){e&&this.loadMore()}},props:{lookingAround:{type:Boolean,default:!1}},data(){return{reachedEnd:!1,feed:{follows:[],global:[],AI:[],bots:[]},feedCounts:{follows:100,global:100,AI:100,bots:100},unreadFeed:{follows:[],global:[],AI:[],bots:[]},feedSet:new Set,bots:[],follows:[],botTracker:"29f63b70d8961835b14062b195fc7d84fa810560b36dde0749e4bc084f0f8952",loadingMore:!0,loadingUnread:!1,tab:"follows",since:Math.round(Date.now()/1e3)-14400,until:Math.round(Date.now()/1e3),profilesUsed:new Set,lastLoaded:this.$store.state.config.timestamps.lastFeedLoad,refreshInterval:null,unsubscribe:null}},computed:{items(){return this.feed[this.tab].slice(0,this.feedCounts[this.tab])}},async mounted(){this.bots=await this.getFollows(this.botTracker),this.follows=this.$store.state.follows,0===this.follows.length&&(this.tab="global"),this.refreshInterval=setInterval((async()=>{let e=await(0,b.Zd)(this.since);if(e)for(let t of e)this.processEvent(t);this.loadingMore&&(this.loadingMore=!1)}),5e3)},async beforeUnmount(){this.listener&&this.listener.cancel(),this.profilesUsed.forEach((e=>this.$store.dispatch("cancelUseProfile",{pubkey:e}))),this.unsubscribe&&this.unsubscribe(),this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async loadMore(){if(this.loadingMore=!0,this.items.length<this.feed[this.tab].length)return console.log("just increased counts"),this.feedCounts[this.tab]+=100,void(this.loadingMore=!1);let e={};for(let s of Object.keys(this.feed))e[s]=[];this.since=this.since-14400;let t=await(0,b.Zd)(this.since);if(t)for(let s of t)this.processEvent(s,e);for(let s of Object.keys(this.feed))this.feed[s]=this.feed[s].concat(e[s]);console.log("loaded feed",this.feed,this.counts),this.loadingMore=!1},loadUnread(){this.loadingUnread=!0,this.feed[this.tab]=this.unreadFeed[this.tab].concat(this.feed[this.tab]),this.unreadFeed[this.tab]=[],this.lastLoaded=Math.round(Date.now()/1e3),this.loadingUnread=!1},processEvent(e,t=this.feed,s=this.unreadFeed){if(!(0,c.nf)(e))return;if(this.feedSet.has(e.id))return;if(e.created_at<this.since)return;let a;this.feedSet.add(e.id),this.interpolateEventMentions(e),this.useProfile(e.pubkey),a=e.pubkey===this.$store.state.keys.pub?t:e.created_at>this.until?s:t,this.follows.includes(e.pubkey)&&(0,h.c)(a.follows,Object.assign({},e),"feed",e.pubkey!==this.$store.state.keys.pub),this.isBot(e)&&(0,h.c)(a.bots,Object.assign({},e),"feed",e.pubkey!==this.$store.state.keys.pub),this.isAI(e)?(0,h.c)(this.feed.AI,Object.assign({},e),"feed",e.pubkey!==this.$store.state.keys.pub):(0,h.c)(a.global,Object.assign({},e),"feed",e.pubkey!==this.$store.state.keys.pub)},async getFollows(e){let t=await(0,b.MD)(e);return t?t.tags.filter((([e,t])=>"p"===e&&t)).map((([e,t])=>t)):[]},useProfile(e){this.profilesUsed.has(e)||(this.profilesUsed.add(e),this.$store.dispatch("useProfile",{pubkey:e}))},isBot(e){return!!this.bots.includes(e.pubkey)||!!e.content.includes("https://www.minds.com/newsfeed/")},isAI(e){return"5c10ed0678805156d39ef1ef6d46110fe1e7e590ae04986ccf48ba1299cb53e2"===e.pubkey||e.tags.findIndex((([e,t])=>"p"===e&&"5c10ed0678805156d39ef1ef6d46110fe1e7e590ae04986ccf48ba1299cb53e2"===t))>=0}}});var m=s(11639),w=s(69885),k=s(47817),y=s(70900),v=s(22857),I=s(69984),M=s.n(I);const A=(0,m.Z)(g,[["render",d],["__scopeId","data-v-55beb4bb"]]),U=A;M()(g,"components",{QPage:w.Z,QTabs:k.Z,QTab:y.Z,QIcon:v.Z})}}]);
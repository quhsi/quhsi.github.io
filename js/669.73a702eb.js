"use strict";(globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[]).push([[669],{38669:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Q});var a=t(59835),i=t(86970),r=t(61957);const o={key:0,class:"flex row justify-center items-start q-my-md"},l={class:"col q-pl-md q-pr-auto flex row"},n={class:"no-padding text-right"},c={key:0,class:"m-8 text-base"},u=(0,a.Uk)(" Start a chat by clicking "),p=(0,a.Uk)(" icon on someone's profile page or user card. ");function d(e,s,t,d,h,m){const b=(0,a.up)("BaseHeader"),g=(0,a.up)("q-spinner-orbit"),k=(0,a.up)("BaseUserCard"),w=(0,a.up)("q-badge"),y=(0,a.up)("q-item"),f=(0,a.up)("q-list"),q=(0,a.up)("q-icon"),v=(0,a.up)("q-page"),x=(0,a.Q2)("ripple");return(0,a.wg)(),(0,a.j4)(v,null,{default:(0,a.w5)((()=>[(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("inbox")),1)])),_:1}),(0,a.Wm)(f,{class:"q-py-sm q-pr-sm q-gutter-sm"},{default:(0,a.w5)((()=>[h.loading?((0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(g,{color:"accent",size:"md"})])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.chats,(s=>(0,a.wy)(((0,a.wg)(),(0,a.j4)(y,{key:s.peer,clickable:"",class:"flex row no-padding no-margin justify-between items-center q-gutter-xs",onClickCapture:(0,r.iM)((t=>e.$router.push({name:"messages",params:{pubkey:e.hexToBech32(s.peer,"npub")}})),["stop"])},{default:(0,a.w5)((()=>[(0,a._)("div",l,[s.peer?((0,a.wg)(),(0,a.j4)(k,{key:0,pubkey:s.peer,"action-buttons":!1,class:"col",clickable:!1,"show-following":!0},null,8,["pubkey"])):(0,a.kq)("",!0),e.$store.state.unreadMessages[s.peer]?((0,a.wg)(),(0,a.j4)(w,{key:1,color:"secondary",outline:"",class:"text-bold q-my-auto"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$store.state.unreadMessages[s.peer]),1)])),_:2},1024)):(0,a.kq)("",!0)]),(0,a._)("label",n,(0,i.zw)(e.niceDateUTC(s.lastMessage)),1)])),_:2},1032,["onClickCapture"])),[[x]]))),128))])),_:1}),h.loading||h.chats.length?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",c,[(0,a._)("p",null,[u,(0,a.Wm)(q,{unelevated:"",color:"primary",name:"mail_lock",size:"md"}),p])]))])),_:1})}t(40702);var h=t(34136),m=t(18933),b=t(31020);const g={title:"astral - inbox",meta:{description:{name:"description",content:"Nostr direct message inbox"},keywords:{name:"keywords",content:"nostr decentralized social media"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}},k={name:"Inbox",mixins:[m.Z,(0,b.Z)(g)],data(){return{chats:[],loading:!0,profilesUsed:new Set,sub:null}},computed:{allChatsNeverRead(){return 0===Object.keys(this.$store.state.lastMessageRead).length}},async mounted(){this.chats=await(0,h.mw)(this.$store.state.keys.pub),this.chats.forEach((({peer:e})=>this.useProfile(e))),this.allChatsNeverRead&&this.chats.forEach((({peer:e})=>this.$store.commit("haveReadMessage",e))),this.loading=!1,this.sub=await(0,h.Qg)((async e=>{e.pubkey!==this.$store.state.keys.pub&&(this.chats=await(0,h.mw)(this.$store.state.keys.pub),this.useProfile(e.pubkey))}))},beforeUnmount(){this.sub&&(this.sub.cancel(),this.sub=null),this.profilesUsed.forEach((e=>this.$store.dispatch("cancelUseProfile",{pubkey:e})))},methods:{markAllAsRead(){this.chats.forEach((e=>{this.$store.commit("haveReadMessage",e.peer)}))},useProfile(e){this.profilesUsed.has(e)||(this.profilesUsed.add(e),this.$store.dispatch("useProfile",{pubkey:e}))}}};var w=t(11639),y=t(69885),f=t(13246),q=t(10786),v=t(490),x=t(20990),U=t(22857),$=t(51136),C=t(69984),Z=t.n(C);const _=(0,w.Z)(k,[["render",d]]),Q=_;Z()(k,"components",{QPage:y.Z,QList:f.Z,QSpinnerOrbit:q.Z,QItem:v.Z,QBadge:x.Z,QIcon:U.Z}),Z()(k,"directives",{Ripple:$.Z})}}]);
"use strict";(globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[]).push([[431],{1938:(t,i,e)=>{e.r(i),e.d(i,{default:()=>_});var s=e(59835),a=e(86970);function o(t,i,e,o,n,c){const r=(0,s.up)("BaseHeader"),h=(0,s.up)("BasePost"),d=(0,s.up)("BaseButtonLoadMore"),l=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(l,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(t.$t("notifications")),1)])),_:1}),(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.notifications,(i=>((0,s.wg)(),(0,s.iD)("div",{key:i.id},[(0,s.Wm)(h,{event:i,highlighted:t.$store.state.lastNotificationRead<i.created_at},null,8,["event","highlighted"])])))),128)),(0,s.Wm)(d,{"loading-more":n.loadingMore,"reached-end":n.reachedEnd,onClick:c.loadMore},null,8,["loading-more","reached-end","onClick"])])])),_:1})}e(40702);var n=e(18933),c=e(26041),r=e(34136),h=e(31020),d=e(80626);const l={title:"astral - notifications",meta:{description:{name:"description",content:"Nostr notifications on astral"},keywords:{name:"keywords",content:"nostr decentralized social media"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}},f={name:"Notifications",mixins:[n.Z,(0,h.Z)(l)],components:{BaseButtonLoadMore:d.Z},data(){return{notifications:[],notificationsSet:new Set,reachedEnd:!1,sub:null,reading:!1,profilesUsed:new Set,loadingMore:!0}},async activated(){this.start()},async deactivated(){this.$store.commit("haveReadNotifications"),this.sub&&this.sub.cancel(),this.profilesUsed.forEach((t=>this.$store.dispatch("cancelUseProfile",{pubkey:t})))},methods:{async start(){this.loadingMore=!0,this.$store.state.unreadNotifications&&this.loadNew();let t=setTimeout((async()=>{this.loadMore()}),4e3);this.sub=(0,r.jg)(this.$store.state.keys.pub,(async i=>{t||await this.processNotifications([i]),t&&clearTimeout(t),t=setTimeout((async()=>{this.loadMore(),clearTimeout(t),t=null}),500)})),this.highlightUnreadNotifications()},async loadMore(){let t;t=this.notifications.length?this.notifications[this.notifications.length-1].created_at-1:Math.round(Date.now()/1e3);let i=await(0,r.t_)(this.$store.state.keys.pub,40,t);await this.processNotifications(i),this.highlightUnreadNotifications(),this.loadingMore=!1},async loadNew(){let t=await(0,r.t_)(this.$store.state.keys.pub,40);await this.processNotifications(t)},processNotifications(t){let i=[];for(let e=0;e<t.length;e++){let i=t[e];this.notificationsSet.has(i.id)||(this.notificationsSet.add(i.id),this.interpolateEventMentions(i),(0,c.aR)(this.notifications,i,((t,i)=>t.created_at<i.created_at)),this.useProfile(i.pubkey))}return i},highlightUnreadNotifications(){this.notifications.length>0&&this.notifications[0].created_at>this.$store.state.lastNotificationRead&&setTimeout((()=>{this.$store.commit("haveReadNotifications")}),3e3*this.notifications.filter((t=>t.created_at>this.$store.state.lastNotificationRead)).length)},addNotificationEvent(t){if(0===this.notifications.length)return void this.notifications.push(t);if(this.notifications[this.notifications.length-1].created_at>=t.created_at)return void this.notifications.push(t);if(this.notifications[0].created_at<=t.created_at)return void this.notifications.unshift(t);let i=this.notifications.findIndex(((i,e,s)=>i.created_at<=t.created_at&&(0===e||s[e-1].created_at>=t.created_at)));i>=0?this.notifications.splice(i,0,t):this.notifications.push(t)},useProfile(t){this.profilesUsed.has(t)||(this.profilesUsed.add(t),this.$store.dispatch("useProfile",{pubkey:t}))}}};var u=e(11639),p=e(69885),g=e(69984),m=e.n(g);const w=(0,u.Z)(f,[["render",o]]),_=w;m()(f,"components",{QPage:p.Z})}}]);
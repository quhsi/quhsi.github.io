"use strict";(globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[]).push([[782],{92782:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var n=s(59835),i=s(86970);const r={key:0,ref:"ancestors"},o={key:1},l={key:1},h={class:"text-h6 text-bold q-px-sm"},a=(0,n._)("div",{style:{"min-height":"30vh"}},null,-1);function d(e,t,s,d,c,v){const p=(0,n.up)("BaseHeader"),u=(0,n.up)("BasePostThread"),E=(0,n.up)("BasePost"),y=(0,n.up)("BaseRelayList"),g=(0,n.up)("q-item"),m=(0,n.up)("q-separator"),b=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(b,{ref:"page"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.$t("thread")),1)])),_:1}),e.ancestorsCompiled.length||e.rootAncestor?((0,n.wg)(),(0,n.iD)("div",r,[(0,n.Wm)(u,{events:e.ancestorsCompiled,"is-ancestors":"",onAddEvent:e.addEventAncestors},null,8,["events","onAddEvent"])],512)):(0,n.kq)("",!0),(0,n.Wm)(g,{ref:"main",class:"no-padding column"},{default:(0,n.w5)((()=>[e.event?((0,n.wg)(),(0,n.j4)(E,{key:0,event:e.event,highlighted:!0,position:e.ancestors.length?"last":"standalone",onAddEvent:e.processChildEvent},null,8,["event","position","onAddEvent"])):((0,n.wg)(),(0,n.iD)("div",o,(0,i.zw)(e.$route.params.eventId),1)),e.event?((0,n.wg)(),(0,n.j4)(y,{key:2,event:e.event,class:"q-px-sm"},null,8,["event"])):(0,n.kq)("",!0)])),_:1},512),(0,n.Wm)(m,{color:"accent",size:"1px"}),e.childrenThreadsFiltered.length?((0,n.wg)(),(0,n.iD)("div",l,[(0,n._)("div",h,(0,i.zw)(e.$t("replies")),1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.childrenThreadsFiltered,(t=>((0,n.wg)(),(0,n.iD)("div",{key:t[0].id},[(0,n.Wm)(u,{events:t,onAddEvent:e.processChildEvent},null,8,["events","onAddEvent"])])))),128))])):(0,n.kq)("",!0),a])),_:1},512)}s(40702),s(46727);var c=s(34136),v=s(18933),p=s(14473),u=s(23738),E=s(31020);const y={title:"astral - thread",meta:{description:{name:"description",content:"Nostr event thread"},keywords:{name:"keywords",content:"nostr decentralized social media"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}},g=(0,n.aZ)({name:"Event",emits:["scroll-to-rect"],mixins:[v.Z,(0,E.Z)(y)],components:{BaseRelayList:u.Z},data(){return{replying:!1,ancestors:[],ancestorsSeen:new Map,ancestorIds:[],rootAncestor:null,event:null,childrenThreads:[],childrenSet:new Set,sub:{},profilesUsed:new Set}},computed:{childrenThreadsFiltered(){return this.childrenThreads.filter((e=>e[0].interpolated.replyEvents.includes(this.hexEventId)))},ancestorsCompiled(){return this.rootAncestor?this.ancestors.length&&this.rootAncestor&&this.ancestors[0].id===this.rootAncestor.id?this.ancestors:[this.rootAncestor].concat(this.ancestors):this.ancestors},hexEventId(){return this.bech32ToHex(this.$route.params.eventId)}},mounted(){this.start()},beforeUnmount(){this.stop()},methods:{async start(){this.sub.event=await(0,c.w8)(this.hexEventId,(e=>{let t=!1;this.event||(t=!0),this.interpolateEventMentions(e),this.event=null,this.event=e,t&&(this.event.interpolated.replyEvents.length&&this.subRootAncestor(),this.subAncestorsChildren()),this.useProfile(e.pubkey)}),!0),this.subAncestorsChildren()},stop(){this.replying=!1,this.sub.event&&this.sub.event.cancel(),this.sub.ancestorsChildren&&this.sub.ancestorsChildren.cancel(),this.sub.rootAncestor&&this.sub.rootAncestor.cancel(),this.profilesUsed.forEach((e=>this.$store.dispatch("cancelUseProfile",{pubkey:e})))},async subRootAncestor(){this.sub.rootAncestor=await(0,c.w8)(this.event.interpolated.replyEvents[0],(e=>{this.processAncestorEvent(e),this.sub.rootAncestor.cancel()}))},async subAncestorsChildren(){var e,t,s;let n=null!==(e=this.event)&&void 0!==e&&null!==(t=e.interpolated)&&void 0!==t&&null!==(s=t.replyEvents)&&void 0!==s&&s.length?[this.hexEventId,this.event.interpolated.replyEvents[0]]:[this.hexEventId];this.sub.ancestorsChildren?this.sub.ancestorsChildren.update("e",n,1):this.sub.ancestorsChildren=await(0,c.dq)("e",n,1,(e=>{this.event&&e.created_at<this.event.created_at?this.processAncestorEvent(e):this.processChildEvent(e)}))},processAncestorEvent(e){var t,s,n;let i=this.ancestors.length?this.ancestors[this.ancestors.length-1]:this.event;if(0===i.interpolated.replyEvents.length)return;let r=this.ancestorsSeen.get(e.id);if(r)return;this.interpolateEventMentions(e),this.ancestorsSeen.set(e.id,e),(null===(t=this.event)||void 0===t||null===(s=t.interpolated)||void 0===s||null===(n=s.replyEvents)||void 0===n?void 0:n[0])===e.id&&(this.rootAncestor=e);let o=i.interpolated.replyEvents[i.interpolated.replyEvents.length-1];if(o===e.id){let t=e;while(t)this.ancestors=[t].concat(this.ancestors),this.scrollToMainEvent(),this.useProfile(t.pubkey),i=t,o=i.interpolated.replyEvents[i.interpolated.replyEvents.length-1],t=this.ancestorsSeen.get(o)}},processChildEvent(e){e.id!==this.hexEventId&&(this.childrenSet.has(e.id)||(this.childrenSet.add(e.id),this.useProfile(e.pubkey),this.interpolateEventMentions(e),(0,p.c)(this.childrenThreads,e,"",e.pubkey!==this.$store.state.keys.pub)))},scrollToMainEvent(){(0,n.Y3)((()=>{var e;let t=null===(e=this.$refs.main)||void 0===e?void 0:e.$el.getBoundingClientRect();this.$emit("scroll-to-rect",t)}))},addEventAncestors(e){this.interpolateEventMentions(e),this.toEvent(e.id)},useProfile(e){this.profilesUsed.has(e)||(this.profilesUsed.add(e),this.$store.dispatch("useProfile",{pubkey:e}))}}});var m=s(11639),b=s(69885),w=s(490),A=s(50926),f=s(69984),k=s.n(f);const C=(0,m.Z)(g,[["render",d]]),x=C;k()(g,"components",{QPage:b.Z,QItem:w.Z,QSeparator:A.Z})}}]);